var w=Object.defineProperty;var v=(o,t,e)=>t in o?w(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var n=(o,t,e)=>(v(o,typeof t!="symbol"?t+"":t,e),e);import{S as L,P as y,a as C,C as b,W as S,O as k,A as x,b as F,D as M,c as A,G as l,M as u,d as P,e as H,f as D,g as z,h as W,i as _,j as E,V as O,k as G}from"./vendor.9c4edca6.js";const R=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}};R();class j{constructor(t){n(this,"el");n(this,"_boundHandleFrame");n(this,"glCanvas",document.createElement("canvas"));n(this,"glContext");n(this,"scene",new L);n(this,"camera",new y(45,window.innerWidth/window.innerHeight,1,2e3));n(this,"renderer");n(this,"controls");n(this,"effect");n(this,"listener");n(this,"spotLight",new C(2241348));this.el=t,this._boundHandleFrame=this._handleFrame.bind(this),t.appendChild(this.glCanvas),this.glCanvas.id="threecanvas",this.scene.background=new b(16777215),this.camera.position.y=15,this.camera.position.z=50,this.scene.add(this.camera);let e=this.glCanvas.getContext("webgl");if(!e)throw new Error("Cannot create WebGL render context in common.ts");this.glContext=e,this.renderer=new S({canvas:this.glCanvas,context:this.glContext,antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.glCanvas.offsetWidth,this.glCanvas.offsetHeight),this.renderer.shadowMap.enabled=!0,this.effect=new k(this.renderer),this.camera.aspect=this.glCanvas.offsetWidth/this.glCanvas.offsetHeight,this.camera.updateProjectionMatrix(),this.listener=new x,this.listener.position.z=1,this.camera.add(this.listener),window.addEventListener("resize",a=>{this.camera.aspect=this.el.offsetWidth/this.el.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.el.offsetWidth,this.el.offsetHeight)}),this.controls=new F(this.camera,this.renderer.domElement),this.controls.listenToKeyEvents(this.glCanvas),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.screenSpacePanning=!1,this.controls.minDistance=3,this.controls.maxDistance=50,this.spotLight.position.set(5,20,15),this.spotLight.angle=.8,this.spotLight.intensity=.7,this.spotLight.penumbra=.8,this.spotLight.castShadow=!0,this.spotLight.shadow.bias=-.001,this.scene.add(this.spotLight),this.scene.add(this.spotLight.target);const s=new M(3355443);s.position.set(-15,15,20),s.castShadow=!0,s.shadow.mapSize.x=1024,s.shadow.mapSize.y=1024,s.shadow.camera.right=20,s.shadow.camera.top=20,s.shadow.camera.left=-20,s.shadow.camera.bottom=-20,s.shadow.bias=-.001,this.scene.add(s);const i=new A(6710886);this.scene.add(i),this.initializeScene(),window.requestAnimationFrame(this._boundHandleFrame)}static offset(t){t=t||window.event;var e=t.target||t.srcElement,s=e.getBoundingClientRect(),i=t.clientX-s.left,a=t.clientY-s.top;return{x:i,y:a}}initializeScene(){}updateScene(t){}_handleFrame(t){window.requestAnimationFrame(this._boundHandleFrame),this.controls.update(),this.updateScene(t),this.doRender()}doRender(){this.effect.render(this.scene,this.camera)}}const B=new G;class I extends j{constructor(t){super(t);n(this,"miku");n(this,"helper");n(this,"root");n(this,"beams",new l);n(this,"monitors",new l);n(this,"ready",!1);this.helper||(this.helper=new u({afterglow:2})),this.root||(this.root=new l)}initializeScene(){this.helper=new u({afterglow:2}),this.root=new l;function t(r){if(r.lengthComputable){const d=r.loaded/r.total*100;console.log(Math.round(d)+"% downloaded")}}const e=this,s="assets/miku/miku_v2.pmd",i=["assets/miku/wavefile_v2.vmd"],a="assets/miku/wavefile_short.mp3",c=new P;c.loadWithAnimation(s,i,function(r){e.miku=r.mesh;var d=e.miku.material;if(Array.isArray(d))for(var h=0,m=d.length;h<m;h++){var p=d[h];p.emissiveIntensity=.2}e.miku.castShadow=!0,e.miku.receiveShadow=!0,e.helper.add(e.miku,{animation:r.animation,physics:!0});const g="assets/miku/wavefile_camera.vmd";c.loadAnimation(g,e.camera,f,t,()=>{})},t,()=>{});const f=function(r){e.helper.add(e.camera,{animation:r}),new H().load(a,function(d){const h=new D(e.listener).setBuffer(d),m={delayTime:160*1/30};e.helper.add(h,m),e.root.add(e.miku),e.root.add(new z(40,15)),e.root.add(new W(new _(256,32),new E({color:16777215,wireframe:!0}))),e.scene.add(e.root),e.ready=!0},t,()=>{})}}updateScene(t){if(this.ready){this.helper.update(B.getDelta());const e=new O;this.miku.children[0].getWorldPosition(e),this.spotLight.target.position.copy(e)}}}function q(){var o=document.getElementById("drawing");if(!o){console.warn("Your HTML page needs a DIV with id='drawing'");return}new I(o)}q();
